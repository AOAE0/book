# 校园二手书交易平台华为云部署文件清单

## 概述

本文档列出了将校园二手书交易系统部署到华为云平台所需的所有配置文件和脚本。

## 文件清单

### 1. 应用配置文件

#### `application-cloud.yml`
- **用途**：华为云环境下的Spring Boot应用配置文件
- **内容**：包含数据库连接、应用端口等配置
- **使用方法**：上传到ECS服务器的 `/home/book-platform/` 目录
- **注意事项**：需要修改其中的数据库连接地址和密码

### 2. 启动和部署脚本

#### `startup.sh`
- **用途**：应用启动脚本
- **功能**：启动Spring Boot应用，设置环境变量，记录日志
- **使用方法**：
  ```bash
  chmod +x startup.sh
  ./startup.sh
  ```
- **注意事项**：确保Java环境已正确安装

#### `deploy.sh`
- **用途**：自动化环境部署脚本
- **功能**：自动安装Java 21、Maven，创建项目目录，配置防火墙
- **使用方法**：
  ```bash
  chmod +x deploy.sh
  ./deploy.sh
  ```
- **注意事项**：需要以root身份运行

### 3. 系统服务配置

#### `book-platform.service`
- **用途**：systemd服务配置文件
- **功能**：配置应用作为系统服务运行，支持开机自启动
- **使用方法**：
  ```bash
  cp book-platform.service /etc/systemd/system/
  systemctl daemon-reload
  systemctl enable book-platform.service
  systemctl start book-platform.service
  ```

### 4. 数据库相关文件

#### `mysql_init.sql`
- **用途**：数据库初始化脚本
- **内容**：创建数据库、表结构，插入测试数据
- **使用方法**：
  ```bash
  mysql -h RDS内网地址 -u root -p wisebookpal < mysql_init.sql
  ```
- **获取位置**：从项目源码的 `backend/src/main/resources/mysql_init.sql` 复制

### 5. 项目构建文件

#### `book-api-0.0.1-SNAPSHOT.jar`
- **用途**：编译后的Spring Boot可执行JAR包
- **获取方法**：在本地项目目录执行 `mvn clean package -DskipTests`
- **上传位置**：上传到ECS服务器的 `/home/book-platform/` 目录
- **注意事项**：确保构建时使用的Java版本与服务器Java版本一致

## 部署流程

### 第一阶段：环境准备

1. **华为云资源准备**
   - 购买RDS MySQL实例
   - 购买ECS云服务器（CentOS 7.6）

2. **文件上传**
   - 使用WinSCP等工具上传所有配置文件到指定目录
   - 确保文件权限设置正确

### 第二阶段：环境配置

1. **执行自动化脚本**（推荐）
   ```bash
   # 在ECS服务器上执行
   chmod +x deploy.sh
   ./deploy.sh --all
   ```

2. **手动配置**（备选方案）
   - 手动安装Java 21
   - 手动安装Maven（如果需要）
   - 创建项目目录结构

### 第三阶段：应用部署

1. **修改配置文件**
   - 编辑 `application-cloud.yml`
   - 更新RDS数据库连接信息

2. **初始化数据库**
   ```bash
   mysql -h RDS内网地址 -u root -p wisebookpal < mysql_init.sql
   ```

3. **启动应用**
   ```bash
   # 使用systemd服务（推荐）
   systemctl start book-platform.service
   
   # 或者使用启动脚本
   ./startup.sh
   ```

### 第四阶段：验证和测试

1. **检查应用状态**
   ```bash
   systemctl status book-platform.service
   journalctl -u book-platform.service -f
   ```

2. **访问应用**
   - 浏览器访问：`http://ECS公网IP:8080/book-api`

## 文件权限要求

确保以下文件具有执行权限：
```bash
chmod +x startup.sh
chmod +x deploy.sh
chmod +x book-platform.service
```

## 环境要求

### ECS服务器
- **操作系统**：CentOS 7.6 64bit
- **Java版本**：OpenJDK 21
- **内存**：建议4GB以上
- **磁盘**：建议40GB以上

### RDS数据库
- **数据库类型**：MySQL 5.7或8.0
- **规格**：建议2vCPUs | 4GB
- **存储**：建议40GB

## 网络配置

### 安全组规则

**ECS安全组：**
- 入方向：TCP 8080（应用端口）
- 入方向：SSH 22（管理端口）

**RDS安全组：**
- 入方向：TCP 3306（MySQL端口）
- 源地址：ECS所在安全组

## 故障排除

### 常见问题

1. **应用启动失败**
   - 检查Java版本：`java -version`
   - 检查配置文件：`application-cloud.yml`
   - 查看启动日志：`journalctl -u book-platform.service`

2. **数据库连接失败**
   - 检查RDS地址和端口
   - 验证用户名密码
   - 确认安全组配置

3. **端口无法访问**
   - 检查防火墙：`firewall-cmd --list-all`
   - 确认ECS安全组配置
   - 验证应用运行状态

### 日志位置

- **systemd服务日志**：`journalctl -u book-platform.service`
- **应用日志**：`/var/log/book-platform.log`
- **系统日志**：`/var/log/messages`

## 维护说明

### 定期维护任务

1. **备份数据库**
   ```bash
   mysqldump -h RDS地址 -u root -p wisebookpal > backup_$(date +%Y%m%d).sql
   ```

2. **更新应用**
   - 停止服务：`systemctl stop book-platform.service`
   - 替换JAR文件
   - 重启服务：`systemctl start book-platform.service`

3. **监控系统资源**
   - CPU使用率
   - 内存使用率
   - 磁盘使用率
   - 网络连接数

### 扩展建议

1. **高可用部署**
   - 配置负载均衡器
   - 部署多个ECS实例
   - 使用弹性伸缩

2. **性能优化**
   - 配置Redis缓存
   - 使用华为云对象存储
   - 数据库读写分离

3. **安全加固**
   - 配置SSL证书
   - 设置访问控制
   - 定期安全扫描

---

**重要提醒**：
- 部署前请仔细阅读华为云部署指南
- 生产环境请使用强密码和SSL连接
- 建议先在测试环境验证部署流程
- 定期备份重要数据和配置